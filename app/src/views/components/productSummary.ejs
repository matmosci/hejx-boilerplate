<div id="product-weight"><%= product.weight %> kg</div>
<button id="add-to-cart" class="btn btn-primary w-100" hx-post="/cart/products" hx-target="#cart-content">Add to cart</button>
<div id="product-prices">
    todo remove
    <% product.prices.map(price => { %>
        <div>{ id: <%= price.id %>, qty: <%= price.qty %> }</div>
    <% }); %>
</div>
<script type="module">
    import EventsHandler from '/js/htmx-events-handler.js';

    EventsHandler.register([
        {
            element: document.getElementById('add-to-cart'),
            event: 'htmx:configRequest',
            handler: (e) => {
                const form = document.getElementById('product-form');
                e.detail.parameters.product = '<%= product.name %>';
                e.detail.parameters.configPath = [...form].map(input => input.value).join("/");
            }
        },
        {
            element: document.getElementById('add-to-cart'),
            event: 'htmx:afterRequest',
            handler: (e) => {
                htmx.ajax('GET', '/cart/length', '#cart-length');
                const cartWrapper = document.getElementById('cart-wrapper');
                const cartWrapperCollapse = bootstrap.Collapse.getOrCreateInstance(cartWrapper);
                cartWrapperCollapse.show();
            }
        }
    ]);
</script>